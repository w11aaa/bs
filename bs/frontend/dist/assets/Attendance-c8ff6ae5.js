import{_ as re,h as i,i as de,v as ue,j as ie,a as y,E as v,b as r,k as ce,o as D,c as E,e as a,w as t,d as u,f as V,F as pe,s as me,z as ve,A as _e,x as fe,t as N,n as be,m as ge,g as j}from"./index-48d38f36.js";const we={class:"admin-attendance-container"},ye={class:"card-header"},Ve={class:"header-actions"},he={class:"filter-container"},Ce={key:0,class:"stats-container"},xe={class:"stat-value"},ke={class:"stat-value"},De={class:"stat-value"},Ne={class:"stat-value"},Ue={class:"pagination-container"},Re={class:"dialog-footer"},ze={__name:"Attendance",setup(Se){const S=i(!1),F=i([]),M=i(0),h=i(1),U=i(10),R=i(""),_=i(""),z=i(""),n=i([]),B=i([]),C=i({totalRecords:0,presentCount:0,absentCount:0,lateCount:0}),I=de(()=>_.value||n.value&&n.value.length===2),x=i(!1),A=i(null),s=ue({id:"",studentName:"",courseName:"",date:"",time:"",status:"",note:""}),T={status:[{required:!0,message:"请选择考勤状态",trigger:"change"}]};ie(()=>{f(),O()});const f=async()=>{S.value=!0;try{const o={page:h.value,limit:U.value,search:R.value,courseId:_.value,status:z.value,startDate:n.value&&n.value.length>0?n.value[0]:null,endDate:n.value&&n.value.length>1?n.value[1]:null},e=await y.get("/admin/attendance",{params:o});F.value=e.data.records,M.value=e.data.total,I.value&&L()}catch(o){console.error("加载考勤记录失败:",o),v.error("加载考勤记录失败")}finally{S.value=!1}},L=async()=>{try{const o={courseId:_.value,startDate:n.value&&n.value.length>0?n.value[0]:null,endDate:n.value&&n.value.length>1?n.value[1]:null},e=await y.get("/admin/attendance/stats",{params:o});C.value=e.data}catch(o){console.error("加载考勤统计失败:",o)}},O=async()=>{try{const o=await y.get("/admin/courses/all");B.value=o.data.map(e=>({id:e.id,name:e.name}))}catch(o){console.error("加载课程列表失败:",o),v.error("加载课程列表失败")}},K=o=>{switch(o){case"present":return"success";case"absent":return"danger";case"late":return"warning";case"leave":return"info";default:return""}},P=o=>{switch(o){case"present":return"出席";case"absent":return"缺席";case"late":return"迟到";case"leave":return"请假";default:return"未知"}},b=()=>{h.value=1,f()},q=o=>{U.value=o,f()},Q=o=>{h.value=o,f()},G=o=>{Object.keys(s).forEach(e=>{s[e]=o[e]}),x.value=!0},H=async()=>{A.value&&await A.value.validate(async o=>{if(o)try{await y.put(`/admin/attendance/${s.id}`,{status:s.status,note:s.note}),v.success("考勤记录更新成功"),x.value=!1,f()}catch(e){console.error("更新考勤记录失败:",e),v.error("更新考勤记录失败")}})},J=async o=>{try{await y.delete(`/admin/attendance/${o}`),v.success("考勤记录删除成功"),f()}catch(e){console.error("删除考勤记录失败:",e),v.error("删除考勤记录失败")}},W=async()=>{try{const o={search:R.value,courseId:_.value,status:z.value,startDate:n.value&&n.value.length>0?n.value[0]:null,endDate:n.value&&n.value.length>1?n.value[1]:null},e=await y.get("/admin/attendance/export",{params:o,responseType:"blob"}),p=window.URL.createObjectURL(new Blob([e.data])),d=document.createElement("a");d.href=p,d.setAttribute("download","考勤记录.xlsx"),document.body.appendChild(d),d.click(),document.body.removeChild(d),v.success("考勤数据导出成功")}catch(o){console.error("导出考勤数据失败:",o),v.error("导出考勤数据失败")}};return(o,e)=>{const p=r("el-button"),d=r("el-option"),Y=r("el-select"),m=r("el-col"),X=r("el-date-picker"),g=r("el-input"),$=r("el-row"),k=r("el-card"),c=r("el-table-column"),Z=r("el-tag"),ee=r("el-popconfirm"),ae=r("el-table"),te=r("el-pagination"),w=r("el-form-item"),le=r("el-form"),oe=r("el-dialog"),ne=ce("loading");return D(),E("div",we,[a(k,{class:"box-card"},{header:t(()=>[u("div",ye,[e[15]||(e[15]=u("h2",null,"考勤记录管理",-1)),u("div",Ve,[a(p,{type:"primary",onClick:W},{default:t(()=>[...e[14]||(e[14]=[V("导出考勤数据",-1)])]),_:1})])])]),default:t(()=>[u("div",he,[a($,{gutter:20},{default:t(()=>[a(m,{span:6},{default:t(()=>[a(Y,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value=l),placeholder:"选择课程",clearable:"",onChange:b},{default:t(()=>[(D(!0),E(pe,null,me(B.value,l=>(D(),j(d,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{span:6},{default:t(()=>[a(Y,{modelValue:z.value,"onUpdate:modelValue":e[1]||(e[1]=l=>z.value=l),placeholder:"考勤状态",clearable:"",onChange:b},{default:t(()=>[a(d,{label:"出席",value:"present"}),a(d,{label:"缺席",value:"absent"}),a(d,{label:"迟到",value:"late"}),a(d,{label:"请假",value:"leave"})]),_:1},8,["modelValue"])]),_:1}),a(m,{span:8},{default:t(()=>[a(X,{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:b},null,8,["modelValue"])]),_:1}),a(m,{span:4},{default:t(()=>[a(g,{modelValue:R.value,"onUpdate:modelValue":e[3]||(e[3]=l=>R.value=l),placeholder:"搜索学生姓名/学号",clearable:"",onClear:b,onKeyup:ve(b,["enter"])},{append:t(()=>[a(p,{icon:_e(fe),onClick:b},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),I.value?(D(),E("div",Ce,[a($,{gutter:20},{default:t(()=>[a(m,{span:6},{default:t(()=>[a(k,{shadow:"hover",class:"stat-card"},{default:t(()=>[u("div",xe,N(C.value.totalRecords||0),1),e[16]||(e[16]=u("div",{class:"stat-label"},"总记录数",-1))]),_:1})]),_:1}),a(m,{span:6},{default:t(()=>[a(k,{shadow:"hover",class:"stat-card present"},{default:t(()=>[u("div",ke,N(C.value.presentCount||0),1),e[17]||(e[17]=u("div",{class:"stat-label"},"出席人次",-1))]),_:1})]),_:1}),a(m,{span:6},{default:t(()=>[a(k,{shadow:"hover",class:"stat-card absent"},{default:t(()=>[u("div",De,N(C.value.absentCount||0),1),e[18]||(e[18]=u("div",{class:"stat-label"},"缺席人次",-1))]),_:1})]),_:1}),a(m,{span:6},{default:t(()=>[a(k,{shadow:"hover",class:"stat-card late"},{default:t(()=>[u("div",Ne,N(C.value.lateCount||0),1),e[19]||(e[19]=u("div",{class:"stat-label"},"迟到人次",-1))]),_:1})]),_:1})]),_:1})])):be("",!0),ge((D(),j(ae,{data:F.value,style:{width:"100%","margin-top":"20px"},border:""},{default:t(()=>[a(c,{prop:"date",label:"日期",width:"120",sortable:""}),a(c,{prop:"time",label:"时间",width:"100"}),a(c,{prop:"courseName",label:"课程",width:"180"}),a(c,{prop:"studentId",label:"学号",width:"120"}),a(c,{prop:"studentName",label:"学生姓名",width:"120"}),a(c,{prop:"teacherName",label:"授课教师",width:"120"}),a(c,{label:"状态",width:"100"},{default:t(l=>[a(Z,{type:K(l.row.status)},{default:t(()=>[V(N(P(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"note",label:"备注",width:"180"}),a(c,{label:"操作",width:"150"},{default:t(l=>[a(p,{size:"small",onClick:se=>G(l.row)},{default:t(()=>[...e[20]||(e[20]=[V("编辑",-1)])]),_:1},8,["onClick"]),a(ee,{title:"确定要删除此考勤记录吗？",onConfirm:se=>J(l.row.id)},{reference:t(()=>[a(p,{size:"small",type:"danger"},{default:t(()=>[...e[21]||(e[21]=[V("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[ne,S.value]]),u("div",Ue,[a(te,{"current-page":h.value,"onUpdate:currentPage":e[4]||(e[4]=l=>h.value=l),"page-size":U.value,"onUpdate:pageSize":e[5]||(e[5]=l=>U.value=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:M.value,onSizeChange:q,onCurrentChange:Q},null,8,["current-page","page-size","total"])])]),_:1}),a(oe,{modelValue:x.value,"onUpdate:modelValue":e[13]||(e[13]=l=>x.value=l),title:"编辑考勤记录",width:"40%"},{footer:t(()=>[u("span",Re,[a(p,{onClick:e[12]||(e[12]=l=>x.value=!1)},{default:t(()=>[...e[22]||(e[22]=[V("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:H},{default:t(()=>[...e[23]||(e[23]=[V("确认",-1)])]),_:1})])]),default:t(()=>[a(le,{ref_key:"recordFormRef",ref:A,model:s,rules:T,"label-width":"100px"},{default:t(()=>[a(w,{label:"学生",prop:"studentName"},{default:t(()=>[a(g,{modelValue:s.studentName,"onUpdate:modelValue":e[6]||(e[6]=l=>s.studentName=l),disabled:""},null,8,["modelValue"])]),_:1}),a(w,{label:"课程",prop:"courseName"},{default:t(()=>[a(g,{modelValue:s.courseName,"onUpdate:modelValue":e[7]||(e[7]=l=>s.courseName=l),disabled:""},null,8,["modelValue"])]),_:1}),a(w,{label:"日期",prop:"date"},{default:t(()=>[a(g,{modelValue:s.date,"onUpdate:modelValue":e[8]||(e[8]=l=>s.date=l),disabled:""},null,8,["modelValue"])]),_:1}),a(w,{label:"时间",prop:"time"},{default:t(()=>[a(g,{modelValue:s.time,"onUpdate:modelValue":e[9]||(e[9]=l=>s.time=l),disabled:""},null,8,["modelValue"])]),_:1}),a(w,{label:"状态",prop:"status"},{default:t(()=>[a(Y,{modelValue:s.status,"onUpdate:modelValue":e[10]||(e[10]=l=>s.status=l),placeholder:"选择考勤状态"},{default:t(()=>[a(d,{label:"出席",value:"present"}),a(d,{label:"缺席",value:"absent"}),a(d,{label:"迟到",value:"late"}),a(d,{label:"请假",value:"leave"})]),_:1},8,["modelValue"])]),_:1}),a(w,{label:"备注",prop:"note"},{default:t(()=>[a(g,{modelValue:s.note,"onUpdate:modelValue":e[11]||(e[11]=l=>s.note=l),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ye=re(ze,[["__scopeId","data-v-28ea4194"]]);export{Ye as default};
