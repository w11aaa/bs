import{_ as A,q as B,h as f,i as N,j as S,b as r,k as q,o as v,c as h,d as o,e as a,w as n,m as E,g as k,n as V,a as Y,E as x,F as T,s as F,f as U,t as b}from"./index-48d38f36.js";const j={name:"StudentAttendance",setup(){const y=B(),t=f(!1),C=f([]),e=f(""),u=f(null),_=f([]);y.query.course_id&&(e.value=y.query.course_id);const R=N(()=>{const s=_.value.length;if(s===0)return{presentRate:0,absentCount:0,lateCount:0};const c=_.value.filter(i=>i.status==="缺勤").length,p=_.value.filter(i=>i.status==="迟到").length,m=s-c-p;return{presentRate:Math.round(m/s*100),absentCount:c,lateCount:p}}),w=async()=>{try{const s=await Y.get("/student/courses");C.value=s.data||[]}catch(s){console.error("加载课程失败:",s),x.error("加载课程失败")}},g=async()=>{t.value=!0;try{let s="/student/attendance";const c={};e.value&&(c.course_id=e.value),u.value&&u.value.length===2&&(c.start_date=u.value[0],c.end_date=u.value[1]);const p=await Y.get(s,{params:c});_.value=p.data||[]}catch(s){console.error("加载考勤记录失败:",s),x.error("加载考勤记录失败")}finally{t.value=!1}},d=s=>{switch(s){case"出勤":return"success";case"缺勤":return"danger";case"迟到":return"warning";default:return"info"}};return S(()=>{w(),g()}),{loading:t,courses:C,selectedCourse:e,dateRange:u,attendanceRecords:_,statistics:R,loadAttendanceRecords:g,getStatusType:d}}},I={class:"attendance-container"},L={class:"filter-section"},z={key:0,class:"empty-block"},G={key:1,class:"statistics-section"},H={class:"stat-item"},J={class:"stat-value"},K={class:"stat-item"},O={class:"stat-value"},P={class:"stat-item"},Q={class:"stat-value"};function W(y,t,C,e,u,_){const R=r("el-option"),w=r("el-select"),g=r("el-date-picker"),d=r("el-table-column"),s=r("el-tag"),c=r("el-table"),p=r("el-empty"),m=r("el-card"),i=r("el-col"),D=r("el-row"),M=q("loading");return v(),h("div",I,[t[6]||(t[6]=o("h2",null,"考勤记录",-1)),o("div",L,[a(w,{modelValue:e.selectedCourse,"onUpdate:modelValue":t[0]||(t[0]=l=>e.selectedCourse=l),placeholder:"选择课程",clearable:"",onChange:e.loadAttendanceRecords},{default:n(()=>[(v(!0),h(T,null,F(e.courses,l=>(v(),k(R,{key:l.id,label:l.course_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),a(g,{modelValue:e.dateRange,"onUpdate:modelValue":t[1]||(t[1]=l=>e.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:e.loadAttendanceRecords},null,8,["modelValue","onChange"])]),E((v(),k(c,{data:e.attendanceRecords,style:{width:"100%"}},{default:n(()=>[a(d,{prop:"course_name",label:"课程名称"}),a(d,{prop:"date",label:"日期",sortable:""}),a(d,{prop:"time",label:"签到时间",sortable:""}),a(d,{prop:"status",label:"状态"},{default:n(({row:l})=>[a(s,{type:e.getStatusType(l.status)},{default:n(()=>[U(b(l.status),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"remarks",label:"备注"})]),_:1},8,["data"])),[[M,e.loading]]),e.attendanceRecords.length===0&&!e.loading?(v(),h("div",z,[a(p,{description:"暂无考勤记录"})])):V("",!0),e.attendanceRecords.length>0?(v(),h("div",G,[t[5]||(t[5]=o("h3",null,"考勤统计",-1)),a(D,{gutter:20},{default:n(()=>[a(i,{span:8},{default:n(()=>[a(m,{shadow:"hover"},{default:n(()=>[o("div",H,[t[2]||(t[2]=o("div",{class:"stat-label"},"出勤率",-1)),o("div",J,b(e.statistics.presentRate)+"%",1)])]),_:1})]),_:1}),a(i,{span:8},{default:n(()=>[a(m,{shadow:"hover"},{default:n(()=>[o("div",K,[t[3]||(t[3]=o("div",{class:"stat-label"},"缺勤次数",-1)),o("div",O,b(e.statistics.absentCount),1)])]),_:1})]),_:1}),a(i,{span:8},{default:n(()=>[a(m,{shadow:"hover"},{default:n(()=>[o("div",P,[t[4]||(t[4]=o("div",{class:"stat-label"},"迟到次数",-1)),o("div",Q,b(e.statistics.lateCount),1)])]),_:1})]),_:1})]),_:1})])):V("",!0)])}const Z=A(j,[["render",W],["__scopeId","data-v-b5ecfe90"]]);export{Z as default};
