import{_ as F,a as k,E as m,r as _,b as i,o as V,c as h,d as y,e as r,w as s,f as u}from"./index-48d38f36.js";const x={name:"Login",data(){return{loginForm:{username:"",password:"",user_type:"student"},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],user_type:[{required:!0,message:"请选择角色",trigger:"change"}]}}},methods:{async login(){var p;try{console.log("开始登录验证"),await this.$refs.loginFormRef.validate(),console.log("表单验证通过");const e={username:this.loginForm.username,password:this.loginForm.password,user_type:this.loginForm.user_type};console.log("准备发送登录请求:",e);const g=await k.create({baseURL:""}).post("http://127.0.0.1:5000/auth/login",e);console.log("登录请求返回响应:",g);const o=g.data;if(console.log("登录请求返回数据:",o),o&&o.message==="登录成功"&&o.user){try{localStorage.setItem("user",JSON.stringify(o.user)),console.log("用户信息已存储到localStorage:",o.user)}catch(l){console.error("localStorage存储失败:",l)}const t="登录成功！用户："+o.user.username+"，角色："+o.user.role;console.log(t),m.success(t);const a=`/${o.user.role}/dashboard`;console.log("准备跳转到:",a),setTimeout(()=>{try{_.push(a),console.log("路由跳转已执行")}catch(l){console.error("路由跳转失败:",l),window.location.href=a,console.log("备用跳转方案已执行")}},100)}else{console.error("登录失败，返回数据格式不正确:",JSON.stringify(o)),console.error("Result object keys:",o?Object.keys(o):"No result object");const t=(o==null?void 0:o.message)||"登录失败，返回数据格式不正确";console.error("详细错误信息:",t),m.error(t)}}catch(e){console.error("Login Error:",e),console.error("Error type:",typeof e),console.error("Error object keys:",Object.keys(e||{})),console.error("Error response:",(e==null?void 0:e.response)||"No response"),console.error("Error request:",(e==null?void 0:e.request)||"No request");let n;e.response?(console.error("Response status:",e.response.status),console.error("Response data:",JSON.stringify(e.response.data)),n=((p=e.response.data)==null?void 0:p.message)||`后端返回错误: ${e.response.status}`):e.request?(console.error("No response received from server"),n="服务器无响应，请检查网络连接"):(console.error("Request setup error:",e.message),n=`请求错误: ${e.message}`),m.error(n)}},toRegister(){_.push("/register")},fillTestCredentials(){this.loginForm.username="admin",this.loginForm.password="admin123",this.loginForm.user_type="admin",m.info("已填充管理员测试凭据")}}},C={class:"login-container"},E={class:"login-form"};function N(p,e,n,g,o,t){const a=i("el-input"),l=i("el-form-item"),c=i("el-radio"),b=i("el-radio-group"),f=i("el-button"),w=i("el-form");return V(),h("div",C,[y("div",E,[e[9]||(e[9]=y("h2",null,"互联网课堂考勤系统",-1)),r(w,{model:o.loginForm,rules:o.rules,ref:"loginFormRef","label-width":"80px"},{default:s(()=>[r(l,{label:"用户名",prop:"username"},{default:s(()=>[r(a,{modelValue:o.loginForm.username,"onUpdate:modelValue":e[0]||(e[0]=d=>o.loginForm.username=d),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(l,{label:"密码",prop:"password"},{default:s(()=>[r(a,{modelValue:o.loginForm.password,"onUpdate:modelValue":e[1]||(e[1]=d=>o.loginForm.password=d),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),r(l,{label:"角色",prop:"user_type"},{default:s(()=>[r(b,{modelValue:o.loginForm.user_type,"onUpdate:modelValue":e[2]||(e[2]=d=>o.loginForm.user_type=d)},{default:s(()=>[r(c,{label:"student"},{default:s(()=>[...e[3]||(e[3]=[u("学生",-1)])]),_:1}),r(c,{label:"teacher"},{default:s(()=>[...e[4]||(e[4]=[u("教师",-1)])]),_:1}),r(c,{label:"admin"},{default:s(()=>[...e[5]||(e[5]=[u("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(l,null,{default:s(()=>[r(f,{type:"primary",onClick:t.login,style:{width:"100%"}},{default:s(()=>[...e[6]||(e[6]=[u("登录",-1)])]),_:1},8,["onClick"])]),_:1}),r(l,null,{default:s(()=>[r(f,{onClick:t.toRegister,style:{width:"100%"}},{default:s(()=>[...e[7]||(e[7]=[u("注册(学生)",-1)])]),_:1},8,["onClick"])]),_:1}),r(l,null,{default:s(()=>[r(f,{onClick:t.fillTestCredentials,type:"info",style:{width:"100%"}},{default:s(()=>[...e[8]||(e[8]=[u("填充测试凭据",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])])])}const R=F(x,[["render",N],["__scopeId","data-v-648c34ff"]]);export{R as default};
