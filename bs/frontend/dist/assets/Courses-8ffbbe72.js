import{_ as O,u as G,h as f,v as H,j as I,b,k as J,o as w,c as R,d as F,e as l,w as r,m as z,g as q,a as y,E as p,l as j,f as v,F as K,s as P,t as E,n as Q}from"./index-48d38f36.js";const W={name:"TeacherCourses",setup(){const L=G(),e=f(!1),h=f([]),o=f([]),k=f(!1),U=f(!1),u=f(!1),s=f([]),m=f(null),g=f(!1),c=f(null),n=H({id:null,course_name:"",course_code:"",category_id:null,credit:2,capacity:50,schedule:"",location:"",description:""}),B={course_name:[{required:!0,message:"请输入课程名称",trigger:"blur"}],course_code:[{required:!0,message:"请输入课程代码",trigger:"blur"}],category_id:[{required:!0,message:"请选择课程类别",trigger:"change"}],credit:[{required:!0,message:"请输入学分",trigger:"blur"}],capacity:[{required:!0,message:"请输入容量",trigger:"blur"}],schedule:[{required:!0,message:"请输入上课时间",trigger:"blur"}],location:[{required:!0,message:"请输入上课地点",trigger:"blur"}]},V=async()=>{e.value=!0;try{const a=await y.get("/teacher/courses");h.value=a.data||[]}catch(a){console.error("加载课程失败:",a),p.error("加载课程失败")}finally{e.value=!1}},S=async()=>{try{const a=await y.get("/course/categories");o.value=a.data||[]}catch(a){console.error("加载课程类别失败:",a),p.error("加载课程类别失败")}},x=(a=null)=>{a?(g.value=!0,Object.assign(n,a)):(g.value=!1,D()),k.value=!0},D=()=>{n.id=null,n.course_name="",n.course_code="",n.category_id=null,n.credit=2,n.capacity=50,n.schedule="",n.location="",n.description=""},t=async()=>{c.value&&await c.value.validate(async a=>{var i,d;if(a)try{g.value?(await y.put(`/teacher/courses/${n.id}`,n),p.success("课程更新成功")):(await y.post("/teacher/courses",n),p.success("课程创建成功")),k.value=!1,V()}catch(_){console.error("保存课程失败:",_),p.error(((d=(i=_.response)==null?void 0:i.data)==null?void 0:d.message)||"保存课程失败")}})},C=async a=>{var i,d;try{await j.confirm("确定要删除该课程吗？删除后将无法恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await y.delete(`/teacher/courses/${a}`),p.success("课程删除成功"),V()}catch(_){_!=="cancel"&&(console.error("删除课程失败:",_),p.error(((d=(i=_.response)==null?void 0:i.data)==null?void 0:d.message)||"删除课程失败"))}},T=async a=>{u.value=!0,U.value=!0;try{const i=await y.get(`/teacher/courses/${a}`);m.value=i.data;const d=await y.get(`/teacher/courses/${a}/students`);s.value=d.data||[]}catch(i){console.error("加载学生名单失败:",i),p.error("加载学生名单失败")}finally{u.value=!1}},N=async a=>{var i,d;if(m.value)try{await j.confirm("确定要将该学生从课程中移除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await y.post(`/teacher/courses/${m.value.id}/remove-student`,{student_id:a}),p.success("学生移除成功"),T(m.value.id)}catch(_){_!=="cancel"&&(console.error("移除学生失败:",_),p.error(((d=(i=_.response)==null?void 0:i.data)==null?void 0:d.message)||"移除学生失败"))}},A=async()=>{if(m.value)try{const a=await y.get(`/teacher/courses/${m.value.id}/export-students`,{responseType:"blob"}),i=window.URL.createObjectURL(new Blob([a.data])),d=document.createElement("a");d.href=i,d.setAttribute("download",`${m.value.course_name}-学生名单.xlsx`),document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(a){console.error("导出学生名单失败:",a),p.error("导出学生名单失败")}},M=a=>{L.push({path:"/teacher/attendance",query:{course_id:a}})};return I(()=>{V(),S()}),{loading:e,courses:h,categories:o,courseDialogVisible:k,studentsDialogVisible:U,studentsLoading:u,enrolledStudents:s,selectedCourse:m,isEdit:g,courseForm:n,courseRules:B,courseFormRef:c,openCourseDialog:x,submitCourseForm:t,deleteCourse:C,viewStudents:T,removeStudent:N,exportStudentList:A,manageAttendance:M}}},X={class:"courses-container"},Y={class:"action-bar"},Z={class:"dialog-footer"},$={key:0,class:"dialog-header"},ee={class:"export-section"};function oe(L,e,h,o,k,U){const u=b("el-button"),s=b("el-table-column"),m=b("el-table"),g=b("el-input"),c=b("el-form-item"),n=b("el-option"),B=b("el-select"),V=b("el-input-number"),S=b("el-form"),x=b("el-dialog"),D=J("loading");return w(),R("div",X,[e[21]||(e[21]=F("h2",null,"课程管理",-1)),F("div",Y,[l(u,{type:"primary",onClick:e[0]||(e[0]=t=>o.openCourseDialog())},{default:r(()=>[...e[12]||(e[12]=[v("创建新课程",-1)])]),_:1})]),z((w(),q(m,{data:o.courses,style:{width:"100%"}},{default:r(()=>[l(s,{prop:"course_name",label:"课程名称"}),l(s,{prop:"course_code",label:"课程代码"}),l(s,{prop:"category",label:"课程类别"}),l(s,{prop:"credit",label:"学分",width:"80"}),l(s,{prop:"capacity",label:"容量",width:"80"}),l(s,{prop:"enrolled_count",label:"已选人数",width:"100"}),l(s,{prop:"schedule",label:"上课时间"}),l(s,{prop:"location",label:"上课地点"}),l(s,{label:"操作",width:"250"},{default:r(({row:t})=>[l(u,{type:"primary",size:"small",onClick:C=>o.openCourseDialog(t)},{default:r(()=>[...e[13]||(e[13]=[v("编辑",-1)])]),_:1},8,["onClick"]),l(u,{type:"success",size:"small",onClick:C=>o.viewStudents(t.id)},{default:r(()=>[...e[14]||(e[14]=[v("学生名单",-1)])]),_:1},8,["onClick"]),l(u,{type:"info",size:"small",onClick:C=>o.manageAttendance(t.id)},{default:r(()=>[...e[15]||(e[15]=[v("考勤管理",-1)])]),_:1},8,["onClick"]),l(u,{type:"danger",size:"small",onClick:C=>o.deleteCourse(t.id)},{default:r(()=>[...e[16]||(e[16]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[D,o.loading]]),l(x,{modelValue:o.courseDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=t=>o.courseDialogVisible=t),title:o.isEdit?"编辑课程":"创建课程",width:"600px"},{footer:r(()=>[F("span",Z,[l(u,{onClick:e[9]||(e[9]=t=>o.courseDialogVisible=!1)},{default:r(()=>[...e[17]||(e[17]=[v("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:o.submitCourseForm},{default:r(()=>[...e[18]||(e[18]=[v("确定",-1)])]),_:1},8,["onClick"])])]),default:r(()=>[l(S,{model:o.courseForm,rules:o.courseRules,ref:"courseFormRef","label-width":"100px"},{default:r(()=>[l(c,{label:"课程名称",prop:"course_name"},{default:r(()=>[l(g,{modelValue:o.courseForm.course_name,"onUpdate:modelValue":e[1]||(e[1]=t=>o.courseForm.course_name=t)},null,8,["modelValue"])]),_:1}),l(c,{label:"课程代码",prop:"course_code"},{default:r(()=>[l(g,{modelValue:o.courseForm.course_code,"onUpdate:modelValue":e[2]||(e[2]=t=>o.courseForm.course_code=t)},null,8,["modelValue"])]),_:1}),l(c,{label:"课程类别",prop:"category_id"},{default:r(()=>[l(B,{modelValue:o.courseForm.category_id,"onUpdate:modelValue":e[3]||(e[3]=t=>o.courseForm.category_id=t),placeholder:"选择课程类别"},{default:r(()=>[(w(!0),R(K,null,P(o.categories,t=>(w(),q(n,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"学分",prop:"credit"},{default:r(()=>[l(V,{modelValue:o.courseForm.credit,"onUpdate:modelValue":e[4]||(e[4]=t=>o.courseForm.credit=t),min:.5,max:10,step:.5},null,8,["modelValue"])]),_:1}),l(c,{label:"容量",prop:"capacity"},{default:r(()=>[l(V,{modelValue:o.courseForm.capacity,"onUpdate:modelValue":e[5]||(e[5]=t=>o.courseForm.capacity=t),min:1,max:500},null,8,["modelValue"])]),_:1}),l(c,{label:"上课时间",prop:"schedule"},{default:r(()=>[l(g,{modelValue:o.courseForm.schedule,"onUpdate:modelValue":e[6]||(e[6]=t=>o.courseForm.schedule=t),placeholder:"例如：周一 8:00-10:00"},null,8,["modelValue"])]),_:1}),l(c,{label:"上课地点",prop:"location"},{default:r(()=>[l(g,{modelValue:o.courseForm.location,"onUpdate:modelValue":e[7]||(e[7]=t=>o.courseForm.location=t)},null,8,["modelValue"])]),_:1}),l(c,{label:"课程描述",prop:"description"},{default:r(()=>[l(g,{modelValue:o.courseForm.description,"onUpdate:modelValue":e[8]||(e[8]=t=>o.courseForm.description=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(x,{modelValue:o.studentsDialogVisible,"onUpdate:modelValue":e[11]||(e[11]=t=>o.studentsDialogVisible=t),title:"课程学生名单",width:"800px"},{default:r(()=>[o.selectedCourse?(w(),R("div",$,[F("h3",null,E(o.selectedCourse.course_name),1),F("p",null,"已选人数: "+E(o.enrolledStudents.length)+" / "+E(o.selectedCourse.capacity),1)])):Q("",!0),z((w(),q(m,{data:o.enrolledStudents,style:{width:"100%"}},{default:r(()=>[l(s,{prop:"student_id",label:"学号"}),l(s,{prop:"name",label:"姓名"}),l(s,{prop:"gender",label:"性别",width:"80"}),l(s,{prop:"major",label:"专业"}),l(s,{prop:"class_name",label:"班级"}),l(s,{prop:"email",label:"邮箱"}),l(s,{label:"操作",width:"100"},{default:r(({row:t})=>[l(u,{type:"danger",size:"small",onClick:C=>o.removeStudent(t.id)},{default:r(()=>[...e[19]||(e[19]=[v("移除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[D,o.studentsLoading]]),F("div",ee,[l(u,{type:"primary",onClick:o.exportStudentList},{default:r(()=>[...e[20]||(e[20]=[v("导出学生名单",-1)])]),_:1},8,["onClick"])])]),_:1},8,["modelValue"])])}const te=O(W,[["render",oe],["__scopeId","data-v-ff1a8404"]]);export{te as default};
