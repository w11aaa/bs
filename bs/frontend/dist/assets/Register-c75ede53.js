import{_ as y,p as C,E as u,a as x,r as c,b as i,o as p,c as w,d as _,e as r,w as o,g as k,f as F}from"./index-48d38f36.js";const R={name:"Register",components:{Plus:C},data(){return{registerForm:{student_id:"",name:"",email:"",username:"",password:"",confirm_password:"",face_image:null,face_image_url:""},rules:{student_id:[{required:!0,message:"请输入学号",trigger:"blur"},{min:8,max:20,message:"学号长度在 8 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:["blur","change"]}],username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:20,message:"用户名长度在 4 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少为 6 个字符",trigger:"blur"}],confirm_password:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,m,d)=>{m!==this.registerForm.password?d(new Error("两次输入的密码不一致")):d()},trigger:"blur"}]}}},methods:{handleAvatarChange(t){this.registerForm.face_image=t.raw;const e=new FileReader;e.onload=m=>{this.registerForm.face_image_url=m.target.result},e.readAsDataURL(t.raw)},async register(){try{if(await this.$refs.registerFormRef.validate(),!this.registerForm.face_image){u.warning("请上传人脸照片");return}const t=new FormData;t.append("student_id",this.registerForm.student_id),t.append("name",this.registerForm.name),t.append("email",this.registerForm.email),t.append("username",this.registerForm.username),t.append("password",this.registerForm.password),t.append("face_image",this.registerForm.face_image),t.append("user_type","student");const e=await x.post("http://127.0.0.1:5000/auth/register",t,{headers:{"Content-Type":"multipart/form-data"}});e.success===!0||!e.message?(u.success("注册成功，请登录"),c.push("/login")):u.error(e.message||"注册失败")}catch(t){u.error("注册失败，请重试"),console.error("Register error:",t)}},toLogin(){c.push("/login")}}},U={class:"register-container"},q={class:"register-form"},P=["src"];function B(t,e,m,d,s,g){const n=i("el-input"),a=i("el-form-item"),b=i("Plus"),h=i("el-icon"),V=i("el-upload"),f=i("el-button"),v=i("el-form");return p(),w("div",U,[_("div",q,[e[9]||(e[9]=_("h2",null,"学生注册",-1)),r(v,{model:s.registerForm,rules:s.rules,ref:"registerFormRef","label-width":"100px"},{default:o(()=>[r(a,{label:"学号",prop:"student_id"},{default:o(()=>[r(n,{modelValue:s.registerForm.student_id,"onUpdate:modelValue":e[0]||(e[0]=l=>s.registerForm.student_id=l),placeholder:"请输入学号"},null,8,["modelValue"])]),_:1}),r(a,{label:"姓名",prop:"name"},{default:o(()=>[r(n,{modelValue:s.registerForm.name,"onUpdate:modelValue":e[1]||(e[1]=l=>s.registerForm.name=l),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),r(a,{label:"邮箱",prop:"email"},{default:o(()=>[r(n,{modelValue:s.registerForm.email,"onUpdate:modelValue":e[2]||(e[2]=l=>s.registerForm.email=l),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),r(a,{label:"用户名",prop:"username"},{default:o(()=>[r(n,{modelValue:s.registerForm.username,"onUpdate:modelValue":e[3]||(e[3]=l=>s.registerForm.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(a,{label:"密码",prop:"password"},{default:o(()=>[r(n,{modelValue:s.registerForm.password,"onUpdate:modelValue":e[4]||(e[4]=l=>s.registerForm.password=l),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),r(a,{label:"确认密码",prop:"confirm_password"},{default:o(()=>[r(n,{modelValue:s.registerForm.confirm_password,"onUpdate:modelValue":e[5]||(e[5]=l=>s.registerForm.confirm_password=l),type:"password",placeholder:"请再次输入密码"},null,8,["modelValue"])]),_:1}),r(a,{label:"人脸图片"},{default:o(()=>[r(V,{class:"avatar-uploader",action:"","on-change":g.handleAvatarChange,"auto-upload":!1,"show-file-list":!0,accept:"image/*"},{default:o(()=>[s.registerForm.face_image_url?(p(),w("img",{key:0,src:s.registerForm.face_image_url,class:"avatar"},null,8,P)):(p(),k(h,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[r(b)]),_:1}))]),_:1},8,["on-change"]),e[6]||(e[6]=_("div",{class:"tip"},"请上传清晰的人脸照片（用于人脸识别考勤）",-1))]),_:1}),r(a,null,{default:o(()=>[r(f,{type:"primary",onClick:g.register,style:{width:"100%"}},{default:o(()=>[...e[7]||(e[7]=[F("注册",-1)])]),_:1},8,["onClick"])]),_:1}),r(a,null,{default:o(()=>[r(f,{onClick:g.toLogin,style:{width:"100%"}},{default:o(()=>[...e[8]||(e[8]=[F("已有账号，去登录",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])])])}const A=y(R,[["render",B],["__scopeId","data-v-f710dc50"]]);export{A as default};
