import{_ as Z,x as $,h as F,v as K,i as ee,y as le,j as ae,b as p,k as te,o as C,c as G,d as U,e,w as o,a as w,E as _,l as W,z as oe,f as d,m as H,g as D,t as z,n as I,F as X}from"./index-48d38f36.js";const re={name:"AdminUsers",components:{Search:$},setup(){const B=F(!1),l=F([]),R=F("student"),a=F(!1),P=F(!1),S=F(!1),g=F(null),k=F(null),u=K({role:"",keyword:""}),v=K({currentPage:1,pageSize:10,total:0}),r=K({id:null,role:"student",name:"",user_id:"",email:"",password:"",gender:"男",age:18,major:"",class_name:"",title:"",department:""}),i=K({role:"student",file:null}),y=ee(()=>{switch(r.role){case"student":return"学号";case"teacher":return"工号";case"admin":return"管理员ID";default:return"用户ID"}}),T={role:[{required:!0,message:"请选择用户类型",trigger:"change"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],user_id:[{required:!0,message:"请输入用户ID",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],major:[{required:!0,message:"请输入专业",trigger:"blur"}],class_name:[{required:!0,message:"请输入班级",trigger:"blur"}],title:[{required:!0,message:"请选择职称",trigger:"change"}],department:[{required:!0,message:"请输入院系",trigger:"blur"}]},m={role:[{required:!0,message:"请选择用户类型",trigger:"change"}],file:[{required:!0,message:"请选择文件",trigger:"change"}]};le(R,n=>{u.role=n,b()});const b=async()=>{B.value=!0;try{const n={page:v.currentPage,limit:v.pageSize,role:u.role,keyword:u.keyword},f=await w.get("/admin/users",{params:n});l.value=f.data.users||[],v.total=f.data.total||0}catch(n){console.error("加载用户失败:",n),_.error("加载用户失败")}finally{B.value=!1}},j=()=>{v.currentPage=1},E=n=>{v.currentPage=n,b()},M=n=>{v.pageSize=n,v.currentPage=1,b()},A=(n=null)=>{x(),n?(S.value=!0,r.id=n.id,r.role=n.role,r.name=n.name,r.email=n.email,n.role==="student"?(r.user_id=n.student_id,r.gender=n.gender,r.age=n.age,r.major=n.major,r.class_name=n.class_name):n.role==="teacher"?(r.user_id=n.teacher_id,r.gender=n.gender,r.title=n.title,r.department=n.department):n.role==="admin"&&(r.user_id=n.admin_id)):S.value=!1,a.value=!0},x=()=>{r.id=null,r.role="student",r.name="",r.user_id="",r.email="",r.password="",r.gender="男",r.age=18,r.major="",r.class_name="",r.title="",r.department=""},L=async()=>{g.value&&await g.value.validate(async n=>{var f,c;if(n)try{const s={name:r.name,email:r.email};r.role==="student"?(s.student_id=r.user_id,s.gender=r.gender,s.age=r.age,s.major=r.major,s.class_name=r.class_name):r.role==="teacher"?(s.teacher_id=r.user_id,s.gender=r.gender,s.title=r.title,s.department=r.department):r.role==="admin"&&(s.admin_id=r.user_id),S.value?(await w.put(`/admin/users/${r.role}/${r.id}`,s),_.success("用户更新成功")):(s.password=r.password,await w.post(`/admin/users/${r.role}`,s),_.success("用户创建成功")),a.value=!1,b()}catch(s){console.error("保存用户失败:",s),_.error(((c=(f=s.response)==null?void 0:f.data)==null?void 0:c.message)||"保存用户失败")}})},O=async n=>{var f,c;try{const s=n.status==="active"?"禁用":"启用";await W.confirm(`确定要${s}该用户吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const J=n.status==="active"?"inactive":"active";await w.put(`/admin/users/${n.role}/${n.id}/status`,{status:J}),_.success(`用户${s}成功`);const Q=l.value.findIndex(Y=>Y.id===n.id);Q!==-1&&(l.value[Q].status=J)}catch(s){s!=="cancel"&&(console.error("更新用户状态失败:",s),_.error(((c=(f=s.response)==null?void 0:f.data)==null?void 0:c.message)||"更新用户状态失败"))}},N=async n=>{var f,c;try{await W.confirm("确定要删除该用户吗？删除后将无法恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w.delete(`/admin/users/${n.role}/${n.id}`),_.success("用户删除成功"),b()}catch(s){s!=="cancel"&&(console.error("删除用户失败:",s),_.error(((c=(f=s.response)==null?void 0:f.data)==null?void 0:c.message)||"删除用户失败"))}},h=()=>{i.role=R.value,i.file=null,P.value=!0},q=n=>{i.file=n.raw},t=async()=>{try{const n=await w.get(`/admin/users/${i.role}/template`,{responseType:"blob"}),f=window.URL.createObjectURL(new Blob([n.data])),c=document.createElement("a");c.href=f,c.setAttribute("download",`${i.role==="student"?"学生":"教师"}导入模板.xlsx`),document.body.appendChild(c),c.click(),document.body.removeChild(c)}catch(n){console.error("下载模板失败:",n),_.error("下载模板失败")}},V=async()=>{k.value&&await k.value.validate(async n=>{var f,c;if(n){if(!i.file){_.warning("请选择文件");return}try{const s=new FormData;s.append("file",i.file),await w.post(`/admin/users/${i.role}/import`,s,{headers:{"Content-Type":"multipart/form-data"}}),_.success("用户导入成功"),P.value=!1,b()}catch(s){console.error("导入用户失败:",s),_.error(((c=(f=s.response)==null?void 0:f.data)==null?void 0:c.message)||"导入用户失败")}}})};return ae(()=>{b()}),{loading:B,users:l,activeTab:R,filterForm:u,pagination:v,userDialogVisible:a,importDialogVisible:P,isEdit:S,userForm:r,importForm:i,userIdLabel:y,userRules:T,importRules:m,userFormRef:g,importFormRef:k,loadUsers:b,handleTabClick:j,handleCurrentChange:E,handleSizeChange:M,openUserDialog:A,submitUserForm:L,toggleUserStatus:O,deleteUser:N,openImportDialog:h,handleFileChange:q,downloadTemplate:t,importUsers:V}}},ne={class:"users-container"},se={class:"filter-section"},ie={class:"action-buttons"},de={class:"pagination-container"},me={class:"dialog-footer"},ue={class:"el-upload__tip"},pe={class:"dialog-footer"};function ge(B,l,R,a,P,S){const g=p("el-option"),k=p("el-select"),u=p("el-form-item"),v=p("Search"),r=p("el-icon"),i=p("el-button"),y=p("el-input"),T=p("el-form"),m=p("el-table-column"),b=p("el-tag"),j=p("el-table"),E=p("el-tab-pane"),M=p("el-tabs"),A=p("el-pagination"),x=p("el-radio"),L=p("el-radio-group"),O=p("el-input-number"),N=p("el-dialog"),h=p("el-upload"),q=te("loading");return C(),G("div",ne,[l[42]||(l[42]=U("h2",null,"用户管理",-1)),U("div",se,[e(T,{inline:!0,class:"filter-form"},{default:o(()=>[e(u,{label:"用户类型"},{default:o(()=>[e(k,{modelValue:a.filterForm.role,"onUpdate:modelValue":l[0]||(l[0]=t=>a.filterForm.role=t),placeholder:"选择用户类型",onChange:a.loadUsers},{default:o(()=>[e(g,{label:"全部",value:""}),e(g,{label:"学生",value:"student"}),e(g,{label:"教师",value:"teacher"}),e(g,{label:"管理员",value:"admin"})]),_:1},8,["modelValue","onChange"])]),_:1}),e(u,{label:"搜索"},{default:o(()=>[e(y,{modelValue:a.filterForm.keyword,"onUpdate:modelValue":l[1]||(l[1]=t=>a.filterForm.keyword=t),placeholder:"姓名/ID/邮箱",clearable:"",onKeyup:oe(a.loadUsers,["enter"])},{append:o(()=>[e(i,{onClick:a.loadUsers},{default:o(()=>[e(r,null,{default:o(()=>[e(v)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeyup"])]),_:1})]),_:1}),U("div",ie,[e(i,{type:"primary",onClick:l[2]||(l[2]=t=>a.openUserDialog())},{default:o(()=>[...l[23]||(l[23]=[d("添加用户",-1)])]),_:1}),e(i,{type:"success",onClick:a.openImportDialog},{default:o(()=>[...l[24]||(l[24]=[d("批量导入",-1)])]),_:1},8,["onClick"])])]),e(M,{modelValue:a.activeTab,"onUpdate:modelValue":l[3]||(l[3]=t=>a.activeTab=t),onTabClick:a.handleTabClick},{default:o(()=>[e(E,{label:"学生",name:"student"},{default:o(()=>[H((C(),D(j,{data:a.users,style:{width:"100%"}},{default:o(()=>[e(m,{prop:"student_id",label:"学号"}),e(m,{prop:"name",label:"姓名"}),e(m,{prop:"email",label:"邮箱"}),e(m,{prop:"gender",label:"性别",width:"80"}),e(m,{prop:"age",label:"年龄",width:"80"}),e(m,{prop:"major",label:"专业"}),e(m,{prop:"class_name",label:"班级"}),e(m,{prop:"status",label:"状态"},{default:o(({row:t})=>[e(b,{type:t.status==="active"?"success":"danger"},{default:o(()=>[d(z(t.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"操作",width:"200"},{default:o(({row:t})=>[e(i,{type:"primary",size:"small",onClick:V=>a.openUserDialog(t)},{default:o(()=>[...l[25]||(l[25]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(i,{type:t.status==="active"?"danger":"success",size:"small",onClick:V=>a.toggleUserStatus(t)},{default:o(()=>[d(z(t.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),e(i,{type:"danger",size:"small",onClick:V=>a.deleteUser(t)},{default:o(()=>[...l[26]||(l[26]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,a.loading]])]),_:1}),e(E,{label:"教师",name:"teacher"},{default:o(()=>[H((C(),D(j,{data:a.users,style:{width:"100%"}},{default:o(()=>[e(m,{prop:"teacher_id",label:"工号"}),e(m,{prop:"name",label:"姓名"}),e(m,{prop:"email",label:"邮箱"}),e(m,{prop:"gender",label:"性别",width:"80"}),e(m,{prop:"title",label:"职称"}),e(m,{prop:"department",label:"院系"}),e(m,{prop:"status",label:"状态"},{default:o(({row:t})=>[e(b,{type:t.status==="active"?"success":"danger"},{default:o(()=>[d(z(t.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"操作",width:"200"},{default:o(({row:t})=>[e(i,{type:"primary",size:"small",onClick:V=>a.openUserDialog(t)},{default:o(()=>[...l[27]||(l[27]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(i,{type:t.status==="active"?"danger":"success",size:"small",onClick:V=>a.toggleUserStatus(t)},{default:o(()=>[d(z(t.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),e(i,{type:"danger",size:"small",onClick:V=>a.deleteUser(t)},{default:o(()=>[...l[28]||(l[28]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,a.loading]])]),_:1}),e(E,{label:"管理员",name:"admin"},{default:o(()=>[H((C(),D(j,{data:a.users,style:{width:"100%"}},{default:o(()=>[e(m,{prop:"admin_id",label:"ID"}),e(m,{prop:"name",label:"姓名"}),e(m,{prop:"email",label:"邮箱"}),e(m,{prop:"status",label:"状态"},{default:o(({row:t})=>[e(b,{type:t.status==="active"?"success":"danger"},{default:o(()=>[d(z(t.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"操作",width:"200"},{default:o(({row:t})=>[e(i,{type:"primary",size:"small",onClick:V=>a.openUserDialog(t)},{default:o(()=>[...l[29]||(l[29]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(i,{type:t.status==="active"?"danger":"success",size:"small",onClick:V=>a.toggleUserStatus(t)},{default:o(()=>[d(z(t.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),e(i,{type:"danger",size:"small",onClick:V=>a.deleteUser(t)},{default:o(()=>[...l[30]||(l[30]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,a.loading]])]),_:1})]),_:1},8,["modelValue","onTabClick"]),U("div",de,[e(A,{"current-page":a.pagination.currentPage,"onUpdate:currentPage":l[4]||(l[4]=t=>a.pagination.currentPage=t),"page-size":a.pagination.pageSize,"onUpdate:pageSize":l[5]||(l[5]=t=>a.pagination.pageSize=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:a.pagination.total,onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),e(N,{modelValue:a.userDialogVisible,"onUpdate:modelValue":l[19]||(l[19]=t=>a.userDialogVisible=t),title:a.isEdit?"编辑用户":"添加用户",width:"600px"},{footer:o(()=>[U("span",me,[e(i,{onClick:l[18]||(l[18]=t=>a.userDialogVisible=!1)},{default:o(()=>[...l[35]||(l[35]=[d("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:a.submitUserForm},{default:o(()=>[...l[36]||(l[36]=[d("确定",-1)])]),_:1},8,["onClick"])])]),default:o(()=>[e(T,{model:a.userForm,rules:a.userRules,ref:"userFormRef","label-width":"100px"},{default:o(()=>[a.isEdit?I("",!0):(C(),D(u,{key:0,label:"用户类型",prop:"role"},{default:o(()=>[e(k,{modelValue:a.userForm.role,"onUpdate:modelValue":l[6]||(l[6]=t=>a.userForm.role=t),placeholder:"选择用户类型"},{default:o(()=>[e(g,{label:"学生",value:"student"}),e(g,{label:"教师",value:"teacher"}),e(g,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1})),e(u,{label:"姓名",prop:"name"},{default:o(()=>[e(y,{modelValue:a.userForm.name,"onUpdate:modelValue":l[7]||(l[7]=t=>a.userForm.name=t)},null,8,["modelValue"])]),_:1}),a.userForm.role!=="admin"||a.isEdit?(C(),D(u,{key:1,label:a.userIdLabel,prop:"user_id"},{default:o(()=>[e(y,{modelValue:a.userForm.user_id,"onUpdate:modelValue":l[8]||(l[8]=t=>a.userForm.user_id=t),disabled:a.isEdit},null,8,["modelValue","disabled"])]),_:1},8,["label"])):I("",!0),e(u,{label:"邮箱",prop:"email"},{default:o(()=>[e(y,{modelValue:a.userForm.email,"onUpdate:modelValue":l[9]||(l[9]=t=>a.userForm.email=t)},null,8,["modelValue"])]),_:1}),a.isEdit?I("",!0):(C(),D(u,{key:2,label:"密码",prop:"password"},{default:o(()=>[e(y,{modelValue:a.userForm.password,"onUpdate:modelValue":l[10]||(l[10]=t=>a.userForm.password=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),a.userForm.role==="student"?(C(),G(X,{key:3},[e(u,{label:"性别",prop:"gender"},{default:o(()=>[e(L,{modelValue:a.userForm.gender,"onUpdate:modelValue":l[11]||(l[11]=t=>a.userForm.gender=t)},{default:o(()=>[e(x,{label:"男"},{default:o(()=>[...l[31]||(l[31]=[d("男",-1)])]),_:1}),e(x,{label:"女"},{default:o(()=>[...l[32]||(l[32]=[d("女",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"年龄",prop:"age"},{default:o(()=>[e(O,{modelValue:a.userForm.age,"onUpdate:modelValue":l[12]||(l[12]=t=>a.userForm.age=t),min:16,max:100},null,8,["modelValue"])]),_:1}),e(u,{label:"专业",prop:"major"},{default:o(()=>[e(y,{modelValue:a.userForm.major,"onUpdate:modelValue":l[13]||(l[13]=t=>a.userForm.major=t)},null,8,["modelValue"])]),_:1}),e(u,{label:"班级",prop:"class_name"},{default:o(()=>[e(y,{modelValue:a.userForm.class_name,"onUpdate:modelValue":l[14]||(l[14]=t=>a.userForm.class_name=t)},null,8,["modelValue"])]),_:1})],64)):I("",!0),a.userForm.role==="teacher"?(C(),G(X,{key:4},[e(u,{label:"性别",prop:"gender"},{default:o(()=>[e(L,{modelValue:a.userForm.gender,"onUpdate:modelValue":l[15]||(l[15]=t=>a.userForm.gender=t)},{default:o(()=>[e(x,{label:"男"},{default:o(()=>[...l[33]||(l[33]=[d("男",-1)])]),_:1}),e(x,{label:"女"},{default:o(()=>[...l[34]||(l[34]=[d("女",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"职称",prop:"title"},{default:o(()=>[e(k,{modelValue:a.userForm.title,"onUpdate:modelValue":l[16]||(l[16]=t=>a.userForm.title=t),placeholder:"选择职称"},{default:o(()=>[e(g,{label:"助教",value:"助教"}),e(g,{label:"讲师",value:"讲师"}),e(g,{label:"副教授",value:"副教授"}),e(g,{label:"教授",value:"教授"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"院系",prop:"department"},{default:o(()=>[e(y,{modelValue:a.userForm.department,"onUpdate:modelValue":l[17]||(l[17]=t=>a.userForm.department=t)},null,8,["modelValue"])]),_:1})],64)):I("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),e(N,{modelValue:a.importDialogVisible,"onUpdate:modelValue":l[22]||(l[22]=t=>a.importDialogVisible=t),title:"批量导入用户",width:"500px"},{footer:o(()=>[U("span",pe,[e(i,{onClick:l[21]||(l[21]=t=>a.importDialogVisible=!1)},{default:o(()=>[...l[40]||(l[40]=[d("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:a.importUsers},{default:o(()=>[...l[41]||(l[41]=[d("导入",-1)])]),_:1},8,["onClick"])])]),default:o(()=>[e(T,{model:a.importForm,rules:a.importRules,ref:"importFormRef","label-width":"100px"},{default:o(()=>[e(u,{label:"用户类型",prop:"role"},{default:o(()=>[e(k,{modelValue:a.importForm.role,"onUpdate:modelValue":l[20]||(l[20]=t=>a.importForm.role=t),placeholder:"选择用户类型"},{default:o(()=>[e(g,{label:"学生",value:"student"}),e(g,{label:"教师",value:"teacher"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"Excel文件",prop:"file"},{default:o(()=>[e(h,{class:"upload-demo",action:"#","auto-upload":!1,"on-change":a.handleFileChange,limit:1,accept:".xlsx,.xls"},{trigger:o(()=>[e(i,{type:"primary"},{default:o(()=>[...l[37]||(l[37]=[d("选择文件",-1)])]),_:1})]),tip:o(()=>[U("div",ue,[l[39]||(l[39]=d(" 请上传Excel文件，格式请参考",-1)),e(i,{type:"text",onClick:a.downloadTemplate},{default:o(()=>[...l[38]||(l[38]=[d("模板文件",-1)])]),_:1},8,["onClick"])])]),_:1},8,["on-change"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const fe=Z(re,[["render",ge],["__scopeId","data-v-4bb135e6"]]);export{fe as default};
