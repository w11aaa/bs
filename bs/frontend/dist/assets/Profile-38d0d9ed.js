import{_ as E,p as L,h as g,v as I,j as N,b as m,o as P,c as x,d as c,e as r,w as l,a as V,E as u,f as F,n as j,t as T,g as D}from"./index-48d38f36.js";const M={name:"TeacherProfile",components:{Plus:L},setup(){const q=g("basic"),a=g(null),y=g(null),e=g(""),f=g(""),_=g(null),d=I({name:"",teacher_id:"",email:"",gender:"",age:30,title:"",department:"",research_area:""}),t=I({current_password:"",new_password:"",confirm_password:""}),U={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],age:[{required:!0,message:"请输入年龄",trigger:"blur"}],title:[{required:!0,message:"请选择职称",trigger:"change"}],department:[{required:!0,message:"请输入所属院系",trigger:"blur"}]},C={current_password:[{required:!0,message:"请输入当前密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}],confirm_password:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(n,o,i)=>{o!==t.new_password?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}]},R=async()=>{try{const o=(await V.get("/teacher/profile")).data;o&&(d.name=o.name||"",d.teacher_id=o.teacher_id||"",d.email=o.email||"",d.gender=o.gender||"",d.age=o.age||30,d.title=o.title||"",d.department=o.department||"",d.research_area=o.research_area||"",w())}catch(n){console.error("加载个人资料失败:",n),u.error("加载个人资料失败")}},w=async()=>{try{const n=await V.get("/teacher/profile/face",{responseType:"blob"});if(n.data.size>0){const o=URL.createObjectURL(n.data);e.value=o}}catch(n){console.error("加载人脸图片失败:",n)}},k=async()=>{a.value&&await a.value.validate(async n=>{var o,i;if(n)try{await V.put("/teacher/profile",d),u.success("个人资料更新成功")}catch(p){console.error("更新个人资料失败:",p),u.error(((i=(o=p.response)==null?void 0:o.data)==null?void 0:i.message)||"更新个人资料失败")}})},b=n=>{_.value=n.raw,n.raw?f.value=URL.createObjectURL(n.raw):f.value=""},h=async()=>{var n,o;if(!_.value){u.warning("请先选择图片");return}try{const i=new FormData;i.append("face",_.value),await V.post("/teacher/profile/face",i,{headers:{"Content-Type":"multipart/form-data"}}),u.success("人脸图片上传成功"),e.value=f.value,f.value="",_.value=null}catch(i){console.error("上传人脸图片失败:",i),u.error(((o=(n=i.response)==null?void 0:n.data)==null?void 0:o.message)||"上传人脸图片失败")}},v=async()=>{y.value&&await y.value.validate(async n=>{var o,i;if(n)try{await V.put("/auth/password",{current_password:t.current_password,new_password:t.new_password}),u.success("密码修改成功"),t.current_password="",t.new_password="",t.confirm_password=""}catch(p){console.error("修改密码失败:",p),u.error(((i=(o=p.response)==null?void 0:o.data)==null?void 0:i.message)||"修改密码失败")}})};return N(()=>{R()}),{activeTab:q,profileForm:d,passwordForm:t,profileRules:U,passwordRules:C,profileFormRef:a,passwordFormRef:y,faceImageUrl:e,facePreview:f,faceFile:_,updateProfile:k,handleFaceChange:b,uploadFace:h,changePassword:v}}},O={class:"profile-container"},z={class:"face-container"},S={key:0,class:"current-face"},A=["src"],G={class:"face-upload"},H=["src"];function J(q,a,y,e,f,_){const d=m("el-input"),t=m("el-form-item"),U=m("el-radio"),C=m("el-radio-group"),R=m("el-input-number"),w=m("el-option"),k=m("el-select"),b=m("el-button"),h=m("el-form"),v=m("el-tab-pane"),n=m("Plus"),o=m("el-icon"),i=m("el-upload"),p=m("el-tabs"),B=m("el-card");return P(),x("div",O,[a[18]||(a[18]=c("h2",null,"个人资料",-1)),r(B,{shadow:"hover",class:"profile-card"},{default:l(()=>[r(p,{modelValue:e.activeTab,"onUpdate:modelValue":a[11]||(a[11]=s=>e.activeTab=s)},{default:l(()=>[r(v,{label:"基本信息",name:"basic"},{default:l(()=>[r(h,{model:e.profileForm,rules:e.profileRules,ref:"profileFormRef","label-width":"100px",class:"profile-form"},{default:l(()=>[r(t,{label:"姓名",prop:"name"},{default:l(()=>[r(d,{modelValue:e.profileForm.name,"onUpdate:modelValue":a[0]||(a[0]=s=>e.profileForm.name=s)},null,8,["modelValue"])]),_:1}),r(t,{label:"工号",prop:"teacher_id"},{default:l(()=>[r(d,{modelValue:e.profileForm.teacher_id,"onUpdate:modelValue":a[1]||(a[1]=s=>e.profileForm.teacher_id=s),disabled:""},null,8,["modelValue"])]),_:1}),r(t,{label:"邮箱",prop:"email"},{default:l(()=>[r(d,{modelValue:e.profileForm.email,"onUpdate:modelValue":a[2]||(a[2]=s=>e.profileForm.email=s)},null,8,["modelValue"])]),_:1}),r(t,{label:"性别",prop:"gender"},{default:l(()=>[r(C,{modelValue:e.profileForm.gender,"onUpdate:modelValue":a[3]||(a[3]=s=>e.profileForm.gender=s)},{default:l(()=>[r(U,{label:"男"},{default:l(()=>[...a[12]||(a[12]=[F("男",-1)])]),_:1}),r(U,{label:"女"},{default:l(()=>[...a[13]||(a[13]=[F("女",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(t,{label:"年龄",prop:"age"},{default:l(()=>[r(R,{modelValue:e.profileForm.age,"onUpdate:modelValue":a[4]||(a[4]=s=>e.profileForm.age=s),min:18,max:100},null,8,["modelValue"])]),_:1}),r(t,{label:"职称",prop:"title"},{default:l(()=>[r(k,{modelValue:e.profileForm.title,"onUpdate:modelValue":a[5]||(a[5]=s=>e.profileForm.title=s),placeholder:"请选择职称"},{default:l(()=>[r(w,{label:"助教",value:"助教"}),r(w,{label:"讲师",value:"讲师"}),r(w,{label:"副教授",value:"副教授"}),r(w,{label:"教授",value:"教授"})]),_:1},8,["modelValue"])]),_:1}),r(t,{label:"所属院系",prop:"department"},{default:l(()=>[r(d,{modelValue:e.profileForm.department,"onUpdate:modelValue":a[6]||(a[6]=s=>e.profileForm.department=s)},null,8,["modelValue"])]),_:1}),r(t,{label:"研究方向",prop:"research_area"},{default:l(()=>[r(d,{modelValue:e.profileForm.research_area,"onUpdate:modelValue":a[7]||(a[7]=s=>e.profileForm.research_area=s),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),r(t,null,{default:l(()=>[r(b,{type:"primary",onClick:e.updateProfile},{default:l(()=>[...a[14]||(a[14]=[F("保存修改",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),r(v,{label:"人脸信息",name:"face"},{default:l(()=>[c("div",z,[e.faceImageUrl?(P(),x("div",S,[a[15]||(a[15]=c("h3",null,"当前人脸照片",-1)),c("img",{src:e.faceImageUrl,alt:"人脸照片",class:"face-image"},null,8,A)])):j("",!0),c("div",G,[c("h3",null,T(e.faceImageUrl?"更新人脸照片":"上传人脸照片"),1),r(i,{class:"avatar-uploader",action:"#","auto-upload":!1,"show-file-list":!1,"on-change":e.handleFaceChange},{default:l(()=>[e.facePreview?(P(),x("img",{key:0,src:e.facePreview,class:"avatar"},null,8,H)):(P(),D(o,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[r(n)]),_:1}))]),_:1},8,["on-change"]),a[16]||(a[16]=c("div",{class:"upload-tip"}," 请上传清晰的正面照片，确保光线充足，面部特征清晰可见 ",-1)),r(b,{type:"primary",onClick:e.uploadFace,disabled:!e.faceFile},{default:l(()=>[F(T(e.faceImageUrl?"更新照片":"上传照片"),1)]),_:1},8,["onClick","disabled"])])])]),_:1}),r(v,{label:"修改密码",name:"password"},{default:l(()=>[r(h,{model:e.passwordForm,rules:e.passwordRules,ref:"passwordFormRef","label-width":"100px",class:"password-form"},{default:l(()=>[r(t,{label:"当前密码",prop:"current_password"},{default:l(()=>[r(d,{modelValue:e.passwordForm.current_password,"onUpdate:modelValue":a[8]||(a[8]=s=>e.passwordForm.current_password=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(t,{label:"新密码",prop:"new_password"},{default:l(()=>[r(d,{modelValue:e.passwordForm.new_password,"onUpdate:modelValue":a[9]||(a[9]=s=>e.passwordForm.new_password=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(t,{label:"确认新密码",prop:"confirm_password"},{default:l(()=>[r(d,{modelValue:e.passwordForm.confirm_password,"onUpdate:modelValue":a[10]||(a[10]=s=>e.passwordForm.confirm_password=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(t,null,{default:l(()=>[r(b,{type:"primary",onClick:e.changePassword},{default:l(()=>[...a[17]||(a[17]=[F("修改密码",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}const Q=E(M,[["render",J],["__scopeId","data-v-ef6f246d"]]);export{Q as default};
