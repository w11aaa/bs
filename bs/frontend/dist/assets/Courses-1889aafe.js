import{_ as E,u as N,h as m,i as z,j as D,b as i,k as K,o as b,c as k,d as L,e,w as n,a as C,E as _,l as M,m as V,g as B,f as h,n as T,t as A}from"./index-48d38f36.js";const S={name:"StudentCourses",setup(){const x=N(),s=m("enrolled"),g=m([]),a=m([]),u=m(!1),f=m(""),t=z(()=>{if(!f.value)return a.value;const l=f.value.toLowerCase();return a.value.filter(r=>r.course_name.toLowerCase().includes(l)||r.teacher_name.toLowerCase().includes(l))}),d=async()=>{u.value=!0;try{const l=await C.get("/student/courses");g.value=l.data||[]}catch(l){console.error("加载已选课程失败:",l),_.error("加载已选课程失败")}finally{u.value=!1}},p=async()=>{u.value=!0;try{const l=await C.get("/student/courses/available");a.value=l.data||[]}catch(l){console.error("加载可选课程失败:",l),_.error("加载可选课程失败")}finally{u.value=!1}},v=async l=>{var r,o;try{await C.post("/student/courses/enroll",{course_id:l}),_.success("选课成功"),d(),p()}catch(c){console.error("选课失败:",c),_.error(((o=(r=c.response)==null?void 0:r.data)==null?void 0:o.message)||"选课失败")}},y=async l=>{var r,o;try{await M.confirm("确定要退选该课程吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.post("/student/courses/drop",{course_id:l}),_.success("退选成功"),d(),p()}catch(c){c!=="cancel"&&(console.error("退选失败:",c),_.error(((o=(r=c.response)==null?void 0:r.data)==null?void 0:o.message)||"退选失败"))}},w=l=>{x.push({path:"/student/attendance",query:{course_id:l}})};return D(()=>{d(),p()}),{activeTab:s,enrolledCourses:g,availableCourses:a,filteredAvailableCourses:t,loading:u,searchKeyword:f,enrollCourse:v,dropCourse:y,viewAttendance:w}}},U={class:"courses-container"},j={key:0,class:"empty-block"},q={key:0,class:"empty-block"};function I(x,s,g,a,u,f){const t=i("el-table-column"),d=i("el-button"),p=i("el-table"),v=i("el-empty"),y=i("el-tab-pane"),w=i("el-input"),l=i("el-tabs"),r=K("loading");return b(),k("div",U,[s[5]||(s[5]=L("h2",null,"我的课程",-1)),e(l,{modelValue:a.activeTab,"onUpdate:modelValue":s[1]||(s[1]=o=>a.activeTab=o)},{default:n(()=>[e(y,{label:"已选课程",name:"enrolled"},{default:n(()=>[V((b(),B(p,{data:a.enrolledCourses,style:{width:"100%"}},{default:n(()=>[e(t,{prop:"course_name",label:"课程名称"}),e(t,{prop:"teacher_name",label:"授课教师"}),e(t,{prop:"schedule",label:"上课时间"}),e(t,{prop:"location",label:"上课地点"}),e(t,{prop:"credit",label:"学分",width:"80"}),e(t,{label:"操作",width:"150"},{default:n(({row:o})=>[e(d,{type:"danger",size:"small",onClick:c=>a.dropCourse(o.id)},{default:n(()=>[...s[2]||(s[2]=[h("退选",-1)])]),_:1},8,["onClick"]),e(d,{type:"primary",size:"small",onClick:c=>a.viewAttendance(o.id)},{default:n(()=>[...s[3]||(s[3]=[h("考勤记录",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[r,a.loading]]),a.enrolledCourses.length===0&&!a.loading?(b(),k("div",j,[e(v,{description:"暂无已选课程"})])):T("",!0)]),_:1}),e(y,{label:"可选课程",name:"available"},{default:n(()=>[e(w,{modelValue:a.searchKeyword,"onUpdate:modelValue":s[0]||(s[0]=o=>a.searchKeyword=o),placeholder:"搜索课程名称或教师","prefix-icon":"Search",clearable:"",class:"search-input"},null,8,["modelValue"]),V((b(),B(p,{data:a.filteredAvailableCourses,style:{width:"100%"}},{default:n(()=>[e(t,{prop:"course_name",label:"课程名称"}),e(t,{prop:"teacher_name",label:"授课教师"}),e(t,{prop:"schedule",label:"上课时间"}),e(t,{prop:"location",label:"上课地点"}),e(t,{prop:"credit",label:"学分",width:"80"}),e(t,{prop:"capacity",label:"剩余名额",width:"100"},{default:n(({row:o})=>[h(A(o.capacity-o.enrolled_count)+"/"+A(o.capacity),1)]),_:1}),e(t,{label:"操作",width:"100"},{default:n(({row:o})=>[e(d,{type:"primary",size:"small",onClick:c=>a.enrollCourse(o.id),disabled:o.capacity<=o.enrolled_count},{default:n(()=>[...s[4]||(s[4]=[h(" 选课 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[r,a.loading]]),a.availableCourses.length===0&&!a.loading?(b(),k("div",q,[e(v,{description:"暂无可选课程"})])):T("",!0)]),_:1})]),_:1},8,["modelValue"])])}const F=E(S,[["render",I],["__scopeId","data-v-fd1153f9"]]);export{F as default};
